#!/usr/bin/env php
<?php

require dirname(__DIR__) . '/vendor/autoload.php';

use App\Command\ImportResultsCommand;
use App\Factory\FtpStorageFactory;
use App\Factory\LocalStorageFactory;
use Dompdf\Dompdf;
use Dompdf\Options;
use League\CLImate\CLImate;
use Symfony\Component\Console\Application;

$application = new Application();

$dotenv = Dotenv\Dotenv::createImmutable(dirname(__DIR__));
$dotenv->load();

//$dotenv->required('FTP_HOST')->notEmpty();
//$dotenv->ifPresent('FTP_PORT')->isInteger();

$loader = new \Twig\Loader\FilesystemLoader(dirname(__DIR__) . '/templates');
$twig = new \Twig\Environment($loader, [
    'debug' => false,
    'cache' => dirname(__DIR__) . '/var/cache/twig',
]);

// pdf
// Configure Dompdf according to your needs
$pdfOptions = new Options();
$pdfOptions
    ->set('defaultFont', 'Arial')
    ->setIsJavascriptEnabled(true)
    ->setIsRemoteEnabled(true)
    //->setDebugPng(true)
;

// Instantiate Dompdf with our options
$dompdf = new Dompdf($pdfOptions);

$filesystem = LocalStorageFactory::createStorage();

$application->add(new ImportResultsCommand(new CLImate, $filesystem, $twig, $dompdf));

$application->run();